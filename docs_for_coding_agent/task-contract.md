# Task Contract（任务契约：如何在本仓库“完整交付”）

本契约用于约束编码智能体与人类协作的交付形态，目标是：
- 交付可复现（别人能跑）
- 交付可回归（有离线门禁）
- 交付可审计（关键命令/关键输出/关键决策可追溯）

说明（对外发布约束）：
- 本仓库的 OSS 形态可能**不包含**内部协作文档（例如 worklog/backlog/协作宪法文件），以避免暴露内部生产信息。
- 因此本契约不要求你向仓库提交这类文件；但仍要求你在 PR/issue 或你们内部系统里保留“命令 + 结果 + 决策”的证据链。

补充（Local / Strict Mode）：
- 当仓库存在本地门禁文件（例如协作宪法/门禁说明）或 CI 显式启用 `REQUIRE_LOCAL_DOCS=1` 时，必须以本地门禁为准（见 `./local-strict-mode.md`）。

---

## 1) 变更分级（必须先判断）

- L0：纯文档更新（更新索引；通常无需新增测试）
- L1：小改动/小 bugfix（写简短 spec；补单测）
- L2：功能交付（写完整 spec；单测 + 至少 1 个集成/场景回归）
- L3：高风险改造（完整 spec + 风险/回滚；单测 + 集成 + 护栏）

## 2) 必交付物（除非明确说明不需要）

1. Spec（先于代码）：
   - `Goal / Constraints / Contract / Acceptance Criteria / Test Plan`
2. Tests（离线回归门禁）：
   - 新增/修复必须有新增/更新测试
3. Docs（面向使用者）：
   - 更新 `help/` 或 `docs_for_coding_agent/`（确保新增能力有“怎么用”的入口）
4. Evidence（可追溯）：
   - 在 PR/issue 或内部工单中记录：关键命令、关键输出、关键决策与理由
5. Task Summary + Index（本地门禁仓库必需）：
   - 产出独立任务总结（见下方模板；并登记索引）
   - 更新 `DOCS_INDEX.md`（新增/删除/重命名文档时必须登记：路径 + 一句话说明）
   - 记录工作流证据（见下方 worklog 最小要素）

## 3) Done 的定义（不要“最小化完成”）

从 backlog（BL-*）移出（或进入 done memo）的前提：
- 能力不是“能跑一次”，而是：
  - contract 明确
  - 离线回归覆盖（happy path + 关键错误路径）
  - 可观测字段齐全
  - 文档与示例可复用

补充约束（避免踩门禁）：
- `.gitignore` 与协作宪法/门禁文件通常为受保护文件；如需修改必须先获得明确授权。

---

## 附录 A：Worklog 最小要素（可直接复制）

你至少需要记录：

- 开始时间（含时区）
- 目标（1~3 条即可）
- 关键变更（文件/模块 + 一句话说明）
- 测试（每条：命令 + 完整结果；包含 passed/failed/skipped 数）
- 决策（如有：做了什么决定 + 为什么）
- 约束核对（例如：是否修改受保护文件）
- 结束时间（含时区）与耗时

---

## 附录 B：Task Summary 模板（7 段）

```markdown
# 任务总结：[标题]

## 1) Goal / Scope
- 目标与范围（不做什么也要写清楚）

## 2) Key Decisions
- 关键决策与取舍（含替代方案）

## 3) Changes
- 变更点列表（按文件/模块归类）

## 4) Test Plan & Results
- 测试命令 + 完整结果（离线优先）

## 5) Known Issues / Risks
- 已知问题、风险、回滚注意事项

## 6) Next Steps
- 后续待办（可选）

## 7) Doc Index Update
- 需要登记索引的文档条目（路径 + 一句话说明）
```
